<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Table - Brand</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/Drag-Drop-File-Input-Upload.css">

    <script src="assets/js/papaparse.min.js"></script>
    <script src='assets/js/jquery-3.6.0.min.js'></script>

    <link rel="stylesheet" type="text/css" href="assets/datatable/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="assets/datatable/buttons.dataTables.min.css">
    <!-- <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js">   </script> -->
    <script type="text/javascript" src="assets/datatable/jquery.dataTables.min.js"> </script>
    <script type="text/javascript" src="assets/datatable/dataTables.buttons.min.js"> </script>
    <script type="text/javascript" src="assets/datatable/jszip.min.js">   </script>
    <script type="text/javascript" src="assets/datatable/pdfmake.min.js">  </script>
    <script type="text/javascript" src="assets/datatable/vfs_fonts.js">    </script>
    <script type="text/javascript" src="assets/datatable/buttons.html5.min.js">  </script>
    <script type="text/javascript" src="assets/datatable/buttons.print.min.js">  </script>



</head>

<body id="page-top">
    <div id="wrapper">
        <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0">
            <div class="container-fluid d-flex flex-column p-0"><a
                    class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-icon rotate-n-15"><i class="fas fa-file-csv"></i></div>
                    <div class="sidebar-brand-text mx-3"><span>CHATZ</span></div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav text-light" id="accordionSidebar">
                    <li class="nav-item"><a class="nav-link active" href="table.html"><i
                                class="fas fa-table"></i><span>Table</span></a></li>
                </ul>
                <div class="text-center d-none d-md-inline"></div>
            </div>
        </nav>
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                    <div class="container-fluid"><button class="btn btn-link d-md-none rounded-circle me-3"
                            id="sidebarToggleTop" type="button"><i class="fas fa-bars"></i></button>
                        <ul class="navbar-nav flex-nowrap ms-auto">
                            <li class="nav-item dropdown d-sm-none no-arrow"><a class="dropdown-toggle nav-link"
                                    aria-expanded="false" data-bs-toggle="dropdown" href="#"><i
                                        class="fas fa-search"></i></a>
                                <div class="dropdown-menu dropdown-menu-end p-3 animated--grow-in"
                                    aria-labelledby="searchDropdown">
                                    <form class="me-auto navbar-search w-100">
                                        <div class="input-group"><input class="bg-light form-control border-0 small"
                                                type="text" placeholder="Search for ...">
                                            <div class="input-group-append"><button class="btn btn-primary py-0"
                                                    type="button"><i class="fas fa-search"></i></button></div>
                                        </div>
                                    </form>
                                </div>
                            </li>
                            <div class="d-none d-sm-block topbar-divider"></div>
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link"
                                        aria-expanded="false" data-bs-toggle="dropdown" href="#"><span
                                            class="d-none d-lg-inline me-2 text-gray-600 small">Zack Dai</span></a>
                                    <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in"><a
                                            class="dropdown-item" href="#"><i
                                                class="fas fa-user fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Profile</a><a
                                            class="dropdown-item" href="#"><i
                                                class="fas fa-cogs fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Settings</a><a
                                            class="dropdown-item" href="#"><i
                                                class="fas fa-list fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Activity
                                            log</a>
                                        <div class="dropdown-divider"></div><a class="dropdown-item" href="#"><i
                                                class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="container-fluid">
                    <div class="card">
                        <div class="card-header py-3">
                            <p class="text-primary m-0 fw-bold">File</p>
                        </div>
                        <div class="card-body">
                            <div class="files color form-group mb-3">
                                <input type="file" multiple="" name="files" id="file-selector" accept=".csv">
                            </div>
                        </div>
                    </div>
                    <div class="card" id="tablecard">
                        <div class="card-header py-3">
                            <p class="text-primary m-0 fw-bold">Table</p>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive table mt-2" id="dataTable" role="grid"
                                aria-describedby="dataTable_info">
                                <button id="download-json">download json</button>
                                <table class="table" id="mytable"></table>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header py-3">
                            <p class="text-primary m-0 fw-bold">Charts</p>
                        </div>

                        <div class="card-body">
                            <div id="chartoptions">
                                <div class="row">
                                    <div class="col-3">
                                        <label class="form-label mb-0" for="float-input">Choose a Chart Type</label>
                                        <select class="form-select" id="charttype">
                                            <option value="histogram">Histogram</option>
                                            <option value="bar">Bar</option>
                                        </select>
                                    </div>
                                    <div class="col-3">
                                        <label class="form-label mb-0" for="xaxis">Choose X axis</label>
                                        <select class="form-select" id="xaxis">
                                            <optgroup label="This is a group" id="columns">

                                            </optgroup>
                                        </select>
                                    </div>
                                    <div class="col-3">
                                        <label class="form-label mb-0" for="yaxis">Choose Y axis</label>
                                        <select class="form-select" id="yaxis">
                                            <optgroup label="This is a group" id="columns2">

                                            </optgroup>
                                        </select>
                                    </div>
                                    <div class="col-3">
                                        <button class="btn-primary" id="makechart">Make Chart</button>
                                    </div>
                                </div>
                            </div>
                            <div id="mychart" style="min-height:500px;height: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>

    </div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/theme.js"></script>
    <script type="text/javascript" src="assets/js/echarts.min.js"></script>
    <script type="text/javascript" src="assets/js/ecStat.min.js"></script>
    <script>
        $(function () {
            // $("#download-json").hide();
            // $("#chartoptions").hide();
            loaddata('https://raw.githubusercontent.com/DaiZack/MLdatasets/master/iris.csv', download = true);
        })
        const fileSelector = document.getElementById('file-selector');
        const downloadTxtFile = (text) => {
            const element = document.createElement("a");
            const file = new Blob([text], {
                type: "text/plain",
            });
            element.href = URL.createObjectURL(file);
            element.download = "myFile.txt";
            document.body.appendChild(element);
            element.click();
        };
        var csv = '';
        var jsonfile = '';
        var data = [];
        var fields = [];
        var dtable;
        var filename = 'Iris Dataset';
        // var dtable = $('#mytable').dataTable(
        //     {
        //         columns:[{'data':'name','title':'name'},{'data':'age','title':'age'}],
        //         data:[{name:'zack',age:20},{name:'zack',age:20},{name:'zack',age:20}]
        //     }
        // );
        function loaddata(filepath, download = false) {

            // parse csv with PapaParse
            var results = Papa.parse(filepath, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                download: download,
                complete: function (results) {
                    // create header for datatable

                    fields = results.meta.fields;
                    var columns = fields.map(x => { return { "data": x, "title": x } });
                    data = results.data;
                    // create datatable
                    if (dtable) {
                        dtable.destroy();
                        $('#mytable').empty();
                    }
                    dtable = $('#mytable').DataTable({
                        columns: columns,
                        data: data,
                        dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel', 'pdf', 'print'
                        ]
                    });
                    $('#columns').empty();
                    $('#columns2').empty();
                    $('#columns').append(fields.map(x => { return `<option value="${x}">${x}</option>` }).join(''));
                    $('#columns2').append(fields.map(x => { return `<option value="${x}">${x}</option>` }).join(''));
                    for (var col of fields) {
                        if (typeof (data[0][col]) == 'number') {
                            $('#xaxis').val(col);
                            break
                        }
                    }
                    makeHistogram();
                }
            });
        }

        fileSelector.addEventListener('change', (event) => {
            const fileList = event.target.files;
            var reader = new FileReader();
            filename = fileList[0].name;
            reader.readAsText(fileList[0]);
            reader.onload = function (event) {
                // read content

                var csv = event.target.result;
                loaddata(csv);
                jsonfile = JSON.stringify(data, null, 2);
                // $('#download-json').show();
                // $('#chartoptions').show();


            };
        });
        $('#download-json').click(function () {
            downloadTxtFile(jsonfile);
        });

        $('#makechart').click(function () {
            var charttype = $('#charttype').val();
            if (charttype == 'histogram') {
                makeHistogram();
            } else if (charttype == 'bar') {
                makeBar();
            } else{
                alert('comming soon');
            }
        });

        function makechart() {
            var dom = document.getElementById('mychart');
            var myChart = echarts.init(dom, null, {
                renderer: 'canvas',
                useDirtyRect: false
            });
            var xAxis = $('#xaxis').val();
            var yAxis = $('#yaxis').val();
            xdata = data.map(x => x[xAxis]);
            ydata = data.map(x => x[yAxis]);
            var option;
            option = {
                legend: {},
                tooltip: {},
                toolbox: {
                    feature: {
                        magicType: {
                            type: ['line', 'bar', 'stack']
                        }
                    },
                }, 
                dataset: {
                    // Define the dimension of array. In cartesian coordinate system,
                    // if the type of x-axis is category, map the first dimension to
                    // x-axis by default, the second dimension to y-axis.
                    // You can also specify 'series.encode' to complete the map
                    // without specify dimensions. Please see below.

                    dimensions: [xAxis, yAxis],
                    source: data
                },
                xAxis: { type: 'category' },
                yAxis: {},
                series: [{ type: 'bar' }]
            };

            if (option && typeof option === 'object') {
                myChart.clear();
                myChart.setOption(option);
            }

            window.addEventListener('resize', myChart.resize);
        }

        function makeHistogram() {
            var dom = document.getElementById('mychart');
            var myChart = echarts.init(dom, null, {
                renderer: 'canvas',
                useDirtyRect: false
            });
            var xAxis = $('#xaxis').val();
            var yAxis = $('#yaxis').val();
            xdata = data.map(x => x[xAxis]);
            ydata = data.map(x => x[yAxis]);

            echarts.registerTransform(ecStat.transform.histogram);
            var girth = xdata;
            var bins = ecStat.histogram(girth);
            var option;
            option = {
                title: {
                    text: filename,
                    left: 'center',
                    top: 20
                },
                color: ['rgb(25, 183, 207)'],
                grid: {
                    left: '3%',
                    right: '3%',
                    bottom: '3%',
                    containLabel: true
                },
                tooltip: {},
                xAxis: {
                    // boundaryGap: '5%',
                    scale: true,
                },
                yAxis: {
                },
                series: [{
                    name: 'height',
                    type: 'bar',
                    barWidth: '99.3%',
                    // barCategoryGap: 0,
                    label: {
                        normal: {
                            show: true,
                            position: 'insideTop'
                        }
                    },
                    data: bins.data
                }]
            };

            if (option && typeof option === 'object') {
                myChart.setOption(option);
            }

            window.addEventListener('resize', myChart.resize);
        }


    </script>

</body>

</html>